extends layout

block content
  h1 Welcome to #{title}

  p You can add data to this page by POSTing values to the "index" store:
    div
      code
        | curl -X POST
        | --header 'Content-Type: application/json'
        | -d '{"value": "hello"}'
        | #{exampleApiUrl}

  p Or replace all values with a PUT:
    div
      code
        | curl -X PUT
        | --header 'Content-Type: application/json'
        | -d '[{"value": "hello"}, {"value": "world"}]'
        | #{exampleApiUrl}

  div#exampleData
    ul#exampleDataList

  script
    var client = new Faye.Client('#{baseUrl}/faye')
      , appendValue = function(value) {
          var li = document.createElement('li');
          li.appendChild(document.createTextNode(value));
          document.getElementById('exampleDataList').appendChild(li);
        };

    var updateValues = function(data) {
        var div = document.getElementById('exampleData')
          , list = document.getElementById('exampleDataList')
          , newList = document.createElement('ul');
        newList.id = 'exampleDataList';
        div.replaceChild(newList, list);
        for (var i=0; i < data.length; i+=1) {
          appendValue(data[i].value);
        }
    };

    client.connect(function () {
      // Connect to private channel to get initial data
      client.subscribe('/private/' + client.getClientId(), function (data) {
        if (data.storeId === 'index') {
          updateValues(data.data);
        }
      });

      // Connect to channel to get updates
      client.subscribe('/data/index', function(data) {
        updateValues(data.data);
      });
    });
